<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>VirtualMenus_App</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: none !important; }
        #unity-container { width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 10; background: transparent !important; }
        #unity-canvas { width: 100%; height: 100%; background: transparent !important; }
        
        /* FORZAMOS EL VIDEO A PANTALLA COMPLETA */
        video { 
            position: absolute !important; top: 0 !important; left: 0 !important; 
            z-index: -1 !important; width: 100vw !important; height: 100vh !important; 
            object-fit: cover !important; 
        }

        #loading-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; }
        #start-ar-btn { display: none; margin-top: 20px; padding: 15px 30px; font-size: 18px; font-weight: bold; color: white; background-color: #ff5722; border: none; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>
    <div id="loading-overlay">
        <img src="SplashVirtualMenus.jpg" style="width: 200px;">
        <p id="loading-text">Cargando: 0%</p>
        <button id="start-ar-btn">INICIAR CÁMARA</button>
    </div>

    <a-scene mindar-image="imageTargetSrc: targets.mind; autoStart: false; uiLoading: no; uiScanning: no;" 
             embedded color-space="sRGB" renderer="alpha: true; colorManagement: true;" vr-mode-ui="enabled: false">
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
        <a-entity mindar-image-target="targetIndex: 0"></a-entity>
    </a-scene>

    <div id="unity-container"><canvas id="unity-canvas"></canvas></div>

    <script>
        const buildUrl = "Build";
        const loaderUrl = buildUrl + "/export_virtualmenuapp.loader.js";
        const config = {
            dataUrl: buildUrl + "/export_virtualmenuapp.data",
            frameworkUrl: buildUrl + "/export_virtualmenuapp.framework.js",
            codeUrl: buildUrl + "/export_virtualmenuapp.wasm",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "Virtual_Menus",
            productName: "VirtualMenus_App",
            productVersion: "0.1",
            // ESTA LÍNEA ES VITAL PARA LA TRANSPARENCIA
            webglContextAttributes: { alpha: true, preserveDrawingBuffer: true }
        };

        const canvas = document.querySelector("#unity-canvas");
        const loadingText = document.querySelector("#loading-text");
        const startBtn = document.querySelector("#start-ar-btn");
        const overlay = document.querySelector("#loading-overlay");

        // ESTO FUE LO QUE BORRÉ POR ERROR (Inyecta el script de Unity)
        const script = document.createElement("script");
        script.src = loaderUrl;
        script.onload = () => {
            createUnityInstance(canvas, config, (progress) => {
                loadingText.innerHTML = "Cargando: " + Math.round(progress * 100) + "%";
            }).then((unityInstance) => {
                startBtn.style.display = "block";
                startBtn.addEventListener("click", () => {
                    overlay.style.display = "none";
                    const sceneEl = document.querySelector('a-scene');
                    if (sceneEl && sceneEl.systems['mindar-image-system']) {
                        sceneEl.systems['mindar-image-system'].start();
                    }
                });
            }).catch((message) => {
                alert("Error al cargar Unity: " + message);
            });
        };
        document.body.appendChild(script);
    </script>
</body>
</html>
