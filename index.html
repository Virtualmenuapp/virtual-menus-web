<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval' https://aframe.io https://cdn.jsdelivr.net blob: data:;">
    
    <title>VirtualMenus_App</title>

    <style>
        body { margin: 0; overflow: hidden; background: #f0f0f0; }
        #loading-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; }
        #loading-bar-container { width: 250px; height: 10px; background: #eee; border-radius: 5px; overflow: hidden; margin-top: 20px; }
        #loading-bar-full { width: 0%; height: 100%; background: #008cff; transition: width 0.2s; }
        #loading-text { font-family: sans-serif; margin-top: 10px; color: #555; font-size: 14px; }
    </style>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
</head>
<body>
    <div id="loading-overlay">
        <img src="SplashVirtualMenus.jpg" style="width: 200px;">
        <div id="loading-bar-container"><div id="loading-bar-full"></div></div>
        <p id="loading-text">Cargando: 0%</p> 
    </div>

    <canvas id="unity-canvas" style="width: 100%; height: 100%; position: absolute; z-index: 10;"></canvas>

    <a-scene mindar-image="imageTargetSrc: targets.mind; autoStart: true; uiLoading: no; uiScanning: no;" embedded vr-mode-ui="enabled: false">
        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
        <a-entity mindar-image-target="targetIndex: 0"></a-entity>
    </a-scene>

    <script>
        const overlay = document.querySelector("#loading-overlay");
        const progressBar = document.querySelector("#loading-bar-full");
        const progressText = document.querySelector("#loading-text");
        const canvas = document.querySelector("#unity-canvas");

        const buildUrl = "Build";
        const loaderUrl = buildUrl + "/export_virtualmenuapp.loader.js";
        const config = {
            dataUrl: buildUrl + "/export_virtualmenuapp.data",
            frameworkUrl: buildUrl + "/export_virtualmenuapp.framework.js",
            codeUrl: buildUrl + "/export_virtualmenuapp.wasm",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "Virtual_Menus",
            productName: "VirtualMenus_App",
            productVersion: "0.1",
        };

        const script = document.createElement("script");
        script.src = loaderUrl;
        script.onload = () => {
            createUnityInstance(canvas, config, (progress) => {
                const p = Math.round(progress * 100);
                progressBar.style.width = p + "%";
                progressText.innerHTML = "Cargando: " + p + "%";
            }).then((unityInstance) => {
                setTimeout(() => { overlay.style.display = "none"; }, 500);
            }).catch((err) => { console.error("Error de Unity: ", err); });
        };
        document.body.appendChild(script);
    </script>
</body>
</html>
